/*! MIT license, more info: wgo.waltheri.net */(function(h,v){var n=function(a){var g=new w(JSON.parse(JSON.stringify(a.getProperties()))),p;for(p in a.children)g.appendChild(n(a.children[p]));return g},q=function(a,g){var p;if(g[a]!==v)return g[a];for(var x in g.children)if(p=q(a,g.children[x]))return p;return!1},u=function(a,g){a.push(JSON.parse(JSON.stringify(g.getProperties())));if(1<g.children.length){for(var p=[],x=0;x<g.children.length;x++){var B=[];u(B,g.children[x]);p.push(B)}a.push(p)}else g.children.length&&u(a,g.children[0])},k=function(a,
g){for(var p,x=1;x<a.length;x++)if(a[x].constructor==Array)for(var B=0;B<a[x].length;B++)p=new w(a[x][B][0]),g.appendChild(p),k(a[x][B],p);else p=new w(a[x]),g.insertAfter(p),g=p},e=function(a){return"string"==typeof a?a.replace(/\\/g,"\\\\").replace(/]/g,"\\]"):a},c=function(a,g){return String.fromCharCode(97+a)+String.fromCharCode(97+g)},d=function(a,g,p){if(g.length){p.sgf+=a;for(var x in g)p.sgf+="["+g[x]+"]"}},l=function(a,g){if(a.move){var p="";a.move.pass||(p=c(a.move.x,a.move.y));g.sgf=a.move.c==
h.B?g.sgf+("B["+p+"]"):g.sgf+("W["+p+"]")}if(a.setup){p=[];var x=[],B=[];for(A in a.setup)a.setup[A].c==h.B?p.push(c(a.setup[A].x,a.setup[A].y)):a.setup[A].c==h.W?x.push(c(a.setup[A].x,a.setup[A].y)):B.push(c(a.setup[A].x,a.setup[A].y));d("AB",p,g);d("AW",x,g);d("AE",B,g)}if(a.markup){p={};for(A in a.markup)p[a.markup[A].type]=p[a.markup[A].type]||[],"LB"==a.markup[A].type?p.LB.push(c(a.markup[A].x,a.markup[A].y)+":"+e(a.markup[A].text)):p[a.markup[A].type].push(c(a.markup[A].x,a.markup[A].y));for(var y in p)d(y,
p[y],g)}var A=a.getProperties();for(y in A)"object"!=typeof A[y]&&(g.sgf="turn"==y?g.sgf+("PL["+(A[y]==h.B?"B":"W")+"]"):"comment"==y?g.sgf+("C["+e(A[y])+"]"):g.sgf+(y+"["+e(A[y])+"]"));if(1==a.children.length)g.sgf+="\n;",l(a.children[0],g);else if(1<a.children.length)for(y in a.children)A=a.children[y],p=g,p.sgf+="(\n;",l(A,p),p.sgf+="\n)"},b=function(){this.size=19;this.info={};this.root=new w;this.propertyCount=this.nodeCount=0};b.prototype={constructor:b,clone:function(){var a=new b;a.size=this.size;
a.info=JSON.parse(JSON.stringify(this.info));a.root=n(this.root);a.nodeCount=this.nodeCount;a.propertyCount=this.propertyCount;return a},hasComments:function(){return!!q("comment",this.root)}};b.fromSgf=function(a){return h.SGF.parse(a)};b.fromJGO=function(a){a="string"==typeof a?JSON.parse(a):a;var g=new b;g.info=JSON.parse(JSON.stringify(a.info));g.size=a.size;g.nodeCount=a.nodeCount;g.propertyCount=a.propertyCount;g.root=new w(a.game[0]);k(a.game,g.root);return g};b.prototype.toSgf=function(){var a=
{sgf:"(\n;"},g={},p;for(p in this.info)"black"==p?(this.info.black.name&&(g.PB=e(this.info.black.name)),this.info.black.rank&&(g.BR=e(this.info.black.rank)),this.info.black.team&&(g.BT=e(this.info.black.team))):"white"==p?(this.info.white.name&&(g.PW=e(this.info.white.name)),this.info.white.rank&&(g.WR=e(this.info.white.rank)),this.info.white.team&&(g.WT=e(this.info.white.team))):g[p]=e(this.info[p]);this.size&&(g.SZ=this.size);g.AP||(g.AP="WGo.js:2");g.FF||(g.FF="4");g.GM||(g.GM="1");g.CA||(g.CA=
"UTF-8");for(p in g)g[p]&&(a.sgf+=p+"["+g[p]+"]");l(this.root,a);a.sgf+=")";return a.sgf};b.prototype.toJGO=function(a){var g={};g.size=this.size;g.info=JSON.parse(JSON.stringify(this.info));g.nodeCount=this.nodeCount;g.propertyCount=this.propertyCount;g.game=[];u(g.game,this.root);return a?JSON.stringify(g):g};var m=function(a){if(a.name){var g=h.filterHTML(a.name);a.rank&&(g+=" ("+h.filterHTML(a.rank)+")");a.team&&(g+=", "+h.filterHTML(a.team))}else a.team&&(g=h.filterHTML(a.team)),a.rank&&(g+=
" ("+h.filterHTML(a.rank)+")");return g};b.infoFormatters={black:m,white:m,TM:function(a){if(0==a)return h.t("none");var g,p=Math.floor(a/60);1==p?g="1 "+h.t("minute"):1<p&&(g=p+" "+h.t("minutes"));p=a%60;1==p?g+=" 1 "+h.t("second"):1<p&&(g+=" "+p+" "+h.t("seconds"));return g},RE:function(a){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+h.filterHTML(a)+'\'" title="'+h.t("res-show-tip")+'">'+h.t("show")+"</a>"}};b.infoList="black white AN CP DT EV GN GC HA ON OT RE RO RU SO TM US PC KM".split(" ");
h.Kifu=b;var f=function(a,g,p){for(var x=0;x<a.length;x++)if(a[x].x==g.x&&a[x].y==g.y){a[x][p]=g[p];return}a.push(g)},r=function(a,g){if(a)for(var p=0;p<a.length;p++)if(a[p].x==g.x&&a[p].y==g.y){a.splice(p,1);break}},w=function(a,g){this.parent=g||null;this.children=[];if(a)for(var p in a)this[p]=a[p]};w.prototype={constructor:w,getChild:function(a){a=a||0;return this.children[a]?this.children[a]:null},addSetup:function(a){this.setup=this.setup||[];f(this.setup,a,"c");return this},removeSetup:function(a){r(this.setup,
a);return this},addMarkup:function(a){this.markup=this.markup||[];f(this.markup,a,"type");return this},removeMarkup:function(a){r(this.markup,a);return this},remove:function(){var a=this.parent;if(!a)throw new Exception("Root node cannot be removed");for(var g in a.children)if(a.children[g]==this){a.children.splice(g,1);break}a.children=a.children.concat(this.children);this.parent=null;return a},insertAfter:function(a){for(var g in this.children)this.children[g].parent=a;a.children=a.children.concat(this.children);
a.parent=this;this.children=[a];return a},appendChild:function(a){a.parent=this;this.children.push(a);return a},getProperties:function(){var a={},g;for(g in this)this.hasOwnProperty(g)&&"children"!=g&&"parent"!=g&&"_"!=g[0]&&(a[g]=this[g]);return a}};h.KNode=w;var z=function(a,g){for(var p=a.size,x=[],B=[],y=0;y<p*p;y++)a.schema[y]&&!g.schema[y]?B.push({x:Math.floor(y/p),y:y%p}):a.schema[y]!=g.schema[y]&&x.push({x:Math.floor(y/p),y:y%p,c:g.schema[y]});return{add:x,remove:B}};m=function(a,g,p){this.kifu=
a;this.node=this.kifu.root;this.allow_illegal=p||!1;this.game=new h.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal);this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=h.W);this.change=E(this.game,this.node,!0);this.rememberPath=g?!0:!1};var C=function(a,g){var p=[],x;for(x in a){var B=!0;for(var y in g)if(a[x].x==g[y].x&&a[x].y==g[y].y){B=!1;break}B&&p.push(a[x])}return p},E=function(a,g,p){g.parent&&(g.parent._last_selected=g.parent.children.indexOf(g));
if(g.move!=v){if(g.move.pass)return a.pass(g.move.c),{add:[],remove:[]};a=a.play(g.move.x,g.move.y,g.move.c);if("number"==typeof a)throw new D(a,g);for(var x in a)if(a[x].x==g.move.x&&a[x].y==g.move.y)return{add:[],remove:a};return{add:[g.move],remove:a}}p||a.pushPosition();p=[];var B=[];if(g.setup!=v)for(x in g.setup)g.setup[x].c?(a.setStone(g.setup[x].x,g.setup[x].y,g.setup[x].c),p.push(g.setup[x])):(a.removeStone(g.setup[x].x,g.setup[x].y),B.push(g.setup[x]));g.turn&&(a.turn=g.turn);return{add:p,
remove:B}},F=function(a){a===v&&this.rememberPath&&(a=this.node._last_selected);a=a||0;var g=this.node.children[a];if(!g)return!1;var p=E(this.game,g);this.path.m++;1<this.node.children.length&&(this.path[this.path.m]=a);this.node=g;return p},G=function(){if(!this.node.parent)return!1;this.node=this.node.parent;this.game.popPosition();this.node.turn&&(this.game.turn=this.node.turn);this.path[this.path.m]!==v&&delete this.path[this.path.m];this.path.m--;return!0},H=function(){this.game.firstPosition();
this.node=this.kifu.root;this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=h.W);this.change=E(this.game,this.node,!0)};m.prototype={constructor:m,next:function(a){this.change=F.call(this,a);return this},last:function(){var a;for(this.change={add:[],remove:[]};a=F.call(this);){var g=this.change;g.add=C(g.add,a.remove).concat(a.add);g.remove=C(g.remove,a.add).concat(a.remove)}return this},previous:function(){var a=this.game.getPosition();G.call(this);this.change=z(a,this.game.getPosition());
return this},first:function(){var a=this.game.getPosition();H.call(this);this.change=z(a,this.game.getPosition());return this},goTo:function(a){if(a===v)return this;var g=this.game.getPosition();H.call(this);for(var p=0;p<a.m&&F.call(this,a[p+1]);p++);this.change=z(g,this.game.getPosition());return this},previousFork:function(){for(var a=this.game.getPosition();G.call(this)&&1==this.node.children.length;);this.change=z(a,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()},
allowIllegalMoves:function(a){a?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}};h.KifuReader=m;var D=function(a,g){this.name="InvalidMoveError";this.message="Invalid move in kifu detected. ";if(g.move&&g.move.c!==v&&g.move.x!==v&&g.move.y!==v){var p=g.move.x;7<g.move.x&&p++;String.fromCharCode(p+65);this.message+="Trying to play "+(g.move.c==h.WHITE?"white":"black")+" move on "+String.fromCharCode(g.move.x+
65)+(19-g.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(a)switch(a){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};D.prototype=Error();D.prototype.constructor=D;h.InvalidMoveError=D;h.i18n.en.show="show";h.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(h,v){h.SGF={};v=function(c,d,l,b,m,f){d=f==d?"black":"white";l.info[d]=l.info[d]||{};l.info[d][c]=m[0]};var n=h.SGF.properties={};n.B=n.W=function(c,d,l,b){d.move=!l[0]||19>=c.size&&"tt"==l[0]?{pass:!0,c:"B"==b?h.B:h.W}:{x:l[0].charCodeAt(0)-97,y:l[0].charCodeAt(1)-97,c:"B"==b?h.B:h.W}};n.AB=n.AW=function(c,d,l,b){for(var m in l)d.addSetup({x:l[m].charCodeAt(0)-97,y:l[m].charCodeAt(1)-97,c:"AB"==b?h.B:h.W})};n.AE=function(c,d,l){for(var b in l)d.addSetup({x:l[b].charCodeAt(0)-97,y:l[b].charCodeAt(1)-
97})};n.PL=function(c,d,l){d.turn="b"==l[0]||"B"==l[0]?h.B:h.W};n.C=function(c,d,l){d.comment=l.join()};n.LB=function(c,d,l){for(var b in l)d.addMarkup({x:l[b].charCodeAt(0)-97,y:l[b].charCodeAt(1)-97,type:"LB",text:l[b].substr(3)})};n.CR=n.SQ=n.TR=n.SL=n.MA=function(c,d,l,b){for(var m in l)d.addMarkup({x:l[m].charCodeAt(0)-97,y:l[m].charCodeAt(1)-97,type:b})};n.SZ=function(c,d,l){c.size=parseInt(l[0])};n.BR=n.WR=v.bind(this,"rank","BR");n.PB=n.PW=v.bind(this,"name","PB");n.BT=n.WT=v.bind(this,"team",
"BT");n.TM=function(c,d,l,b){c.info[b]=l[0];d.BL=l[0];d.WL=l[0]};var q=/\(|\)|(;(\s*[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+)*)/g,u=/[A-Z]+(\s*((\[\])|(\[(.|\s)*?([^\\]\]))))+/g,k=/[A-Z]+/,e=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;h.SGF.parse=function(c){var d=[],l=new h.Kifu,b=null;c=c.match(q);for(var m in c)if("("==c[m])d.push(b);else if(")"==c[m])b=d.pop();else{b&&l.nodeCount++;b=b?b.appendChild(new h.KNode):l.root;var f=c[m].match(u)||[];l.propertyCount+=f.length;for(var r in f){var w=k.exec(f[r])[0];
var z=f[r].match(e);for(var C in z)z[C]=z[C].substring(1,z[C].length-1).replace(/\\(?!\\)/g,"");if(h.SGF.properties[w])h.SGF.properties[w](l,b,z,w);else 1>=z.length&&(z=z[0]),b.parent?b[w]=z:l.info[w]=z}}return l}})(WGo);(function(h){var v=function(f,r){this.name="FileError";this.message=1==r?"File '"+f+"' is empty.":2==r?"Network error. It is not possible to read '"+f+"'.":"File '"+f+"' hasn't been found on server."};v.prototype=Error();v.prototype.constructor=v;h.FileError=v;var n=h.loadFromUrl=function(f,r){var w=new XMLHttpRequest;w.onreadystatechange=function(){if(4==w.readyState)if(200==w.status){if(0==w.responseText.length)throw new v(f,1);r(w.responseText)}else throw new v(f);};try{w.open("GET",f,!0),w.send()}catch(z){throw new v(f,
2);}},q=function(f){f.change&&this.board.update(f.change);this.temp_marks&&this.board.removeObject(this.temp_marks);var r=[];this.notification();f.node.move&&this.config.markLastMove&&(f.node.move.pass?this.notification(h.t((f.node.move.c==h.B?"b":"w")+"pass")):r.push({type:"CR",x:f.node.move.x,y:f.node.move.y}));if(1<f.node.children.length&&this.config.displayVariations)for(var w=0;w<f.node.children.length;w++)f.node.children[w].move&&!f.node.children[w].move.pass&&r.push({type:"LB",text:String.fromCharCode(65+
w),x:f.node.children[w].move.x,y:f.node.children[w].move.y,c:this.board.theme.variationColor||"rgba(0,32,128,0.8)"});if(f.node.markup){for(w in f.node.markup)for(var z=0;z<r.length;z++)f.node.markup[w].x==r[z].x&&f.node.markup[w].y==r[z].y&&(r.splice(z,1),z--);r=r.concat(f.node.markup)}this.temp_marks=r;this.board.addObject(r)},u=function(f){this.board.setSize(f.kifu.size);this.board.removeAllObjects();this.config.enableWheel&&this.setWheel(!0)},k=function(f,r){return f==r.element||f==r.element?!1:
f._wgo_scrollable||f.scrollHeight>f.offsetHeight&&"auto"==window.getComputedStyle(f).overflow?!0:k(f.parentNode,r)},e=function(f){var r=f.wheelDelta||-1*f.detail;return k(f.target,this)?!0:0>r?(this.next(),this.config.lockScroll&&f.preventDefault&&f.preventDefault(),!this.config.lockScroll):0<r?(this.previous(),this.config.lockScroll&&f.preventDefault&&f.preventDefault(),!this.config.lockScroll):!0},c=function(f){if(document.querySelector("input:focus, textarea:focus"))return!0;switch(f.keyCode){case 39:this.next();
break;case 37:this.previous();break;default:return!0}this.config.lockScroll&&f.preventDefault&&f.preventDefault();return!this.config.lockScroll},d=function(f,r){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var w in this.kifuReader.node.children)if(this.kifuReader.node.children[w].move&&this.kifuReader.node.children[w].move.x==f&&this.kifuReader.node.children[w].move.y==r){this.next(w);break}},l=function(f){this.config=f;for(var r in l.default)void 0===this.config[r]&&void 0!==l.default[r]&&
(this.config[r]=l.default[r]);this.element=document.createElement("div");this.board=new h.Board(this.element,this.config.board);this.init();this.initGame()};l.prototype={constructor:l,init:function(){this.kifu=null;this.listeners={kifuLoaded:[u.bind(this)],update:[q.bind(this)],frozen:[],unfrozen:[]};this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded);this.config.update&&this.addEventListener("update",this.config.update);this.config.frozen&&this.addEventListener("frozen",
this.config.frozen);this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen);this.board.addEventListener("click",d.bind(this));this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,this.config.move):this.config.sgfFile&&this.loadSgfFromFile(this.config.sgfFile,this.config.move)},update:function(f){this.kifuReader&&this.kifuReader.change&&
(f={type:"update",op:f,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change},this.dispatchEvent(f))},loadKifu:function(f,r){this.kifu=f;this.kifuReader=new h.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves);this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu});this.update("init");r&&this.goTo(r)},loadSgf:function(f,r){try{this.loadKifu(h.Kifu.fromSgf(f),r)}catch(w){this.error(w)}},
loadJSON:function(f,r){try{this.loadKifu(h.Kifu.fromJGO(f),r)}catch(w){this.error(w)}},loadSgfFromFile:function(f,r){var w=this;try{n(f,function(z){w.loadSgf(z,r)})}catch(z){this.error(z)}},addEventListener:function(f,r){this.listeners[f]=this.listeners[f]||[];this.listeners[f].push(r)},removeEventListener:function(f,r){this.listeners[f]&&(r=this.listeners[f].indexOf(r),-1!=r&&this.listeners[f].splice(r,1))},dispatchEvent:function(f){if(this.listeners[f.type])for(var r in this.listeners[f.type])this.listeners[f.type][r](f)},
notification:function(f){console&&f&&console.log(f)},help:function(f){console&&console.log(f)},error:function(f){if(!h.ERROR_REPORT)throw f;console&&console.log(f)},next:function(f){if(!this.frozen&&this.kifu)try{this.kifuReader.next(f),this.update()}catch(r){this.error(r)}},previous:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.previous(),this.update()}catch(f){this.error(f)}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(f){this.error(f)}},
first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),this.update()}catch(f){this.error(f)}},goTo:function(f){if(!this.frozen&&this.kifu){"function"==typeof f&&(f=f.call(this));if("number"==typeof f){var r=h.clone(this.kifuReader.path);r.m=f||0}else r=f;try{this.kifuReader.goTo(r),this.update()}catch(w){this.error(w)}}},getGameInfo:function(){if(!this.kifu)return null;var f={},r;for(r in this.kifu.info)-1!=h.Kifu.infoList.indexOf(r)&&(h.Kifu.infoFormatters[r]?f[h.t(r)]=h.Kifu.infoFormatters[r](this.kifu.info[r]):
f[h.t(r)]=h.filterHTML(this.kifu.info[r]));return f},setFrozen:function(f){this.frozen=f;this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",target:this})},appendTo:function(f){f.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(f){document.onkeydown=f?c.bind(this):null},setWheel:function(f){!this._wheel_listener&&f?(this._wheel_listener=e.bind(this),f=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.addEventListener(f,
this._wheel_listener)):this._wheel_listener&&!f&&(f=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.removeEventListener(f,this._wheel_listener),delete this._wheel_listener)},setCoordinates:function(f){!this.coordinates&&f?(this.board.setSection(-.5,-.5,-.5,-.5),this.board.addCustomObject(h.Board.coordinates)):this.coordinates&&!f&&(this.board.setSection(0,0,0,0),this.board.removeCustomObject(h.Board.coordinates));this.coordinates=f}};l.default={sgf:void 0,json:void 0,sgfFile:void 0,
move:void 0,board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0,displayVariations:!0};h.Player=l;var b={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",
black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."},m;for(m in b)h.i18n.en[m]=b[m]})(WGo);(function(h){var v=0,n=function(k,e,c){var d={};d.element=document.createElement("div");d.element.className="wgo-player-"+k;d.wrapper=document.createElement("div");d.wrapper.className="wgo-player-"+k+"-wrapper";d.element.appendChild(d.wrapper);e.appendChild(d.element);c||(d.element.style.display="none");return d},q=function(k){var e;if(e=this.currentLayout.layout?this.currentLayout.layout[k]:this.currentLayout[k]){this.regions[k].element.style.display="block";e.constructor!=Array&&(e=[e]);for(var c in e)this.components[e[c]]||
(this.components[e[c]]=new u.component[e[c]](this)),this.components[e[c]].appendTo(this.regions[k].wrapper),this.components[e[c]]._detachFromPlayer=!1}else this.regions[k].element.style.display="none"},u=h.extendClass(h.Player,function(k,e){this.config=e;for(var c in u.default)void 0===this.config[c]&&void 0!==u.default[c]&&(this.config[c]=u.default[c]);for(c in h.Player.default)void 0===this.config[c]&&void 0!==h.Player.default[c]&&(this.config[c]=h.Player.default[c]);this.element=k;this.element.innerHTML=
"";this.classes=(this.element.className?this.element.className+" ":"")+"wgo-player-main";this.element.className=this.classes;this.element.id||(this.element.id="wgo_"+v++);this.dom={};this.dom.center=document.createElement("div");this.dom.center.className="wgo-player-center";this.dom.board=document.createElement("div");this.dom.board.className="wgo-player-board";this.regions={};this.regions.left=n("left",this.element);this.element.appendChild(this.dom.center);this.regions.right=n("right",this.element);
this.regions.top=n("top",this.dom.center);this.dom.center.appendChild(this.dom.board);this.regions.bottom=n("bottom",this.dom.center);this.board=new h.Board(this.dom.board,this.config.board);this.init();this.components={};window.addEventListener("resize",function(){this.noresize||this.updateDimensions()}.bind(this));this.updateDimensions();this.initGame()});u.prototype.appendTo=function(k){k.appendChild(this.element);this.updateDimensions()};u.prototype.updateDimensions=function(){for(var k=window.getComputedStyle(this.element),
e=[];this.element.firstChild;)e.push(this.element.firstChild),this.element.removeChild(this.element.firstChild);var c=parseInt(k.width),d=parseInt(k.height),l=parseInt(k.maxHeight)||0;for(k=0;k<e.length;k++)this.element.appendChild(e[k]);if(c!=this.width||d!=this.height||l!=this.maxHeight){this.width=c;this.height=d;this.maxHeight=l;a:if(e=this.config.layout,e.constructor==Array){c=this.height||this.maxHeight;for(d=0;d<e.length;d++)if(!e[d].conditions||!(e[d].conditions.minWidth&&!(e[d].conditions.minWidth<=
this.width)||e[d].conditions.minHeight&&c&&!(e[d].conditions.minHeight<=c)||e[d].conditions.maxWidth&&!(e[d].conditions.maxWidth>=this.width)||e[d].conditions.maxHeight&&c&&!(e[d].conditions.maxHeight>=c)||e[d].conditions.custom&&!e[d].conditions.custom.call(this))){e=e[d];break a}e=void 0}if((this.currentLayout=e)&&this.lastLayout!=this.currentLayout){this.element.className=this.currentLayout.className?this.classes+" "+this.currentLayout.className:this.classes;for(var b in this.components)this.components[b]._detachFromPlayer=
!0;q.call(this,"left");q.call(this,"right");q.call(this,"top");q.call(this,"bottom");for(b in this.components)this.components[b]._detachFromPlayer&&this.components[b].element.parentNode&&this.components[b].element.parentNode.removeChild(this.components[b].element);this.lastLayout=this.currentLayout}e=this.dom.board.clientWidth;(b=this.height||this.maxHeight)&&(b-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight);b&&b<e?b!=this.board.height&&this.board.setHeight(b):e!=
this.board.width&&this.board.setWidth(e);e=b-e;0<e?(this.dom.board.style.height=b+"px",this.dom.board.style.paddingTop=e/2+"px"):(this.dom.board.style.height="auto",this.dom.board.style.paddingTop="0");this.regions.left.element.style.height=this.dom.center.offsetHeight+"px";this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(k in this.components)this.components[k].updateDimensions&&this.components[k].updateDimensions()}};u.prototype.showMessage=function(k,e,c){this.info_overlay=
document.createElement("div");this.info_overlay.style.width=this.element.offsetWidth+"px";this.info_overlay.style.height=this.element.offsetHeight+"px";this.info_overlay.className="wgo-info-overlay";this.element.appendChild(this.info_overlay);var d=document.createElement("div");d.className="wgo-info-message";d.innerHTML=k;k=document.createElement("div");k.className="wgo-info-close";c||(k.innerHTML=h.t("BP:closemsg"));d.appendChild(k);this.info_overlay.appendChild(d);e?this.info_overlay.addEventListener("click",
function(l){e(l)}):c||this.info_overlay.addEventListener("click",function(l){this.hideMessage()}.bind(this));this.setFrozen(!0)};u.prototype.hideMessage=function(){this.element.removeChild(this.info_overlay);this.setFrozen(!1)};u.prototype.error=function(k){if(!h.ERROR_REPORT)throw k;switch(k.name){case "InvalidMoveError":this.showMessage("<h1>"+k.name+"</h1><p>"+k.message+'</p><p>If this message isn\'t correct, please report it by clicking <a href="#">here</a>, otherwise contact maintainer of this site.</p>');
break;case "FileError":this.showMessage("<h1>"+k.name+"</h1><p>"+k.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");break;default:this.showMessage("<h1>"+k.name+"</h1><p>"+k.message+"</p><pre>"+k.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="#">here</a>.</p>')}};u.component={};u.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[]},right:{right:[]},
minimal:{bottom:[]}};u.dynamicLayout=[{conditions:{minWidth:650},layout:u.layouts.right_top,className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:u.layouts.one_column,className:"wgo-medium"},{conditions:{minWidth:350},layout:u.layouts.no_comment,className:"wgo-small"},{layout:u.layouts.no_comment,className:"wgo-xsmall"}];u.default={layout:u.dynamicLayout};h.i18n.en["BP:closemsg"]="click anywhere to close this window";u.attributes={"data-wgo":function(k){k&&("("==k[0]?
this.sgf=k:this.sgfFile=k)},"data-wgo-board":function(k){this.board=eval("({"+k+"})")},"data-wgo-onkifuload":function(k){this.kifuLoaded=new Function(k)},"data-wgo-onupdate":function(k){this.update=new Function(k)},"data-wgo-onfrozen":function(k){this.frozen=new Function(k)},"data-wgo-onunfrozen":function(k){this.unfrozen=new Function(k)},"data-wgo-layout":function(k){this.layout=eval("({"+k+"})")},"data-wgo-enablewheel":function(k){"false"==k.toLowerCase()&&(this.enableWheel=!1)},"data-wgo-lockscroll":function(k){"false"==
k.toLowerCase()&&(this.lockScroll=!1)},"data-wgo-enablekeys":function(k){"false"==k.toLowerCase()&&(this.enableKeys=!1)},"data-wgo-rememberpath":function(k){"false"==k.toLowerCase()&&(this.rememberPath=!1)},"data-wgo-allowillegal":function(k){"false"!=k.toLowerCase()&&(this.allowIllegalMoves=!0)},"data-wgo-move":function(k){var e=parseInt(k);isNaN(e)?this.move=eval("({"+k+"})"):this.move=e},"data-wgo-marklastmove":function(k){"false"==k.toLowerCase()&&(this.markLastMove=!1)},"data-wgo-diagram":function(k){k&&
("("==k[0]?this.sgf=k:this.sgfFile=k,this.enableWheel=this.enableKeys=this.markLastMove=!1,this.layout={top:[],right:[],left:[],bottom:[]})}};h.BasicPlayer=u;window.addEventListener("load",function(){for(var k=document.querySelectorAll("[data-wgo],[data-wgo-diagram]"),e=0;e<k.length;e++){var c=k[e];var d={};for(var l=0;l<c.attributes.length;l++){var b=c.attributes[l];u.attributes[b.name]&&u.attributes[b.name].call(d,b.value,b.name)}d=new u(c,d);c._wgo_player=d}})})(WGo);(function(h,v){v=function(){this.element=document.createElement("div")};v.prototype={constructor:v,appendTo:function(n){n.appendChild(this.element)},getWidth:function(){var n=window.getComputedStyle(this.element);return parseInt(n.width)},getHeight:function(){var n=window.getComputedStyle(this.element);return parseInt(n.height)},updateDimensions:function(){}};h.BasicPlayer.component.Component=v})(WGo);(function(){var h=function(c){this[c]={};var d=this[c];d.box=document.createElement("div");d.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+c;d.name=document.createElement("div");d.name.className="wgo-box-title";d.name.innerHTML=c;d.box.appendChild(d.name);c=document.createElement("div");c.className="wgo-player-info";d.box.appendChild(c);d.info={};d.info.rank=v("rank");d.info.rank.val.innerHTML="-";d.info.caps=v("caps");d.info.caps.val.innerHTML="0";d.info.time=v("time");d.info.time.val.innerHTML=
"--:--";c.appendChild(d.info.rank.wrapper);c.appendChild(d.info.caps.wrapper);c.appendChild(d.info.time.wrapper)},v=function(c){var d={};d.wrapper=document.createElement("div");d.wrapper.className="wgo-player-info-box-wrapper";d.box=document.createElement("div");d.box.className="wgo-player-info-box";d.wrapper.appendChild(d.box);d.title=document.createElement("div");d.title.className="wgo-player-info-title";d.title.innerHTML=WGo.t(c);d.box.appendChild(d.title);d.val=document.createElement("div");d.val.className=
"wgo-player-info-value";d.box.appendChild(d.val);return d},n=function(c){c=c.kifu.info||{};c.black?(this.black.name.innerHTML=WGo.filterHTML(c.black.name)||WGo.t("black"),this.black.info.rank.val.innerHTML=WGo.filterHTML(c.black.rank)||"-"):(this.black.name.innerHTML=WGo.t("black"),this.black.info.rank.val.innerHTML="-");c.white?(this.white.name.innerHTML=WGo.filterHTML(c.white.name)||WGo.t("white"),this.white.info.rank.val.innerHTML=WGo.filterHTML(c.white.rank)||"-"):(this.white.name.innerHTML=WGo.t("white"),
this.white.info.rank.val.innerHTML="-");this.black.info.caps.val.innerHTML="0";this.white.info.caps.val.innerHTML="0";c.TM?(this.setPlayerTime("black",c.TM),this.setPlayerTime("white",c.TM)):(this.black.info.time.val.innerHTML="--:--",this.white.info.time.val.innerHTML="--:--");this.updateDimensions()},q=function(c){if(c.style.fontSize){var d=parseInt(c.style.fontSize);c.style.fontSize="";var l=window.getComputedStyle(c);l=parseInt(l.fontSize);c.style.fontSize=d+"px"}else l=window.getComputedStyle(c),
l=d=parseInt(l.fontSize);if(!(d==l&&c.scrollHeight<=c.offsetHeight))if(c.scrollHeight>c.offsetHeight)for(d-=2;c.scrollHeight>c.offsetHeight&&1<d;)c.style.fontSize=d+"px",d-=2;else if(d<l){for(d+=2;c.scrollHeight<=c.offsetHeight&&d<=l;)c.style.fontSize=d+"px",d+=2;c.scrollHeight>c.offsetHeight&&(c.style.fontSize=d-4+"px")}},u=function(c){c.node.BL&&this.setPlayerTime("black",c.node.BL);c.node.WL&&this.setPlayerTime("white",c.node.WL);void 0!==c.position.capCount.black&&(this.black.info.caps.val.innerHTML=
c.position.capCount.black);void 0!==c.position.capCount.white&&(this.white.info.caps.val.innerHTML=c.position.capCount.white)},k=WGo.extendClass(WGo.BasicPlayer.component.Component,function(c){this.super(c);this.element.className="wgo-infobox";h.call(this,"white");h.call(this,"black");this.element.appendChild(this.white.box);this.element.appendChild(this.black.box);c.addEventListener("kifuLoaded",n.bind(this));c.addEventListener("update",u.bind(this))});k.prototype.setPlayerTime=function(c,d){var l=
Math.round(d)%60;this[c].info.time.val.innerHTML=Math.floor(d/60)+":"+(10>l?"0"+l:l)};k.prototype.updateDimensions=function(){q(this.black.name);q(this.white.name)};var e=WGo.BasicPlayer.layouts;e.right_top.right.push("InfoBox");e.right.right.push("InfoBox");e.one_column.top.push("InfoBox");e.no_comment.top.push("InfoBox");WGo.i18n.en.rank="Rank";WGo.i18n.en.caps="Caps";WGo.i18n.en.time="Time";WGo.BasicPlayer.component.InfoBox=k})(WGo);(function(h,v){var n=function(e){var c=e.charCodeAt(0)-97;0>c&&(c+=32);7<c&&c--;var d=e.charCodeAt(1)-48;2<e.length&&(d=10*d+(e.charCodeAt(2)-48));d=this.kifuReader.game.size-d;this._tmp_mark={type:"MA",x:c,y:d};this.board.addObject(this._tmp_mark)},q=function(){this.board.removeObject(this._tmp_mark);delete this._tmp_mark},u=function(e,c){for(var d in e)e[d].className&&"wgo-move-link"==e[d].className?(e[d].addEventListener("mouseover",n.bind(c,e[d].innerHTML)),e[d].addEventListener("mouseout",q.bind(c))):
e[d].childNodes&&e[d].childNodes.length&&u(e[d].childNodes,c)},k=function(e,c){var d='<div class="wgo-info-list">';c&&(d+='<div class="wgo-info-title">'+h.t("gameinfo")+"</div>");for(var l in e)d+='<div class="wgo-info-item"><span class="wgo-info-label">'+l+'</span><span class="wgo-info-value">'+e[l]+"</span></div>";return d+"</div>"};v=h.extendClass(h.BasicPlayer.component.Component,function(e){this.super(e);this.player=e;this.element.className="wgo-commentbox";this.box=document.createElement("div");
this.box.className="wgo-box-wrapper wgo-comments-wrapper";this.element.appendChild(this.box);this.comments_title=document.createElement("div");this.comments_title.className="wgo-box-title";this.comments_title.innerHTML=h.t("comments");this.box.appendChild(this.comments_title);this.comments=document.createElement("div");this.comments.className="wgo-comments-content";this.box.appendChild(this.comments);this.help=document.createElement("div");this.help.className="wgo-help";this.help.style.display="none";
this.comments.appendChild(this.help);this.notification=document.createElement("div");this.notification.className="wgo-notification";this.notification.style.display="none";this.comments.appendChild(this.notification);this.comment_text=document.createElement("div");this.comment_text.className="wgo-comment-text";this.comments.appendChild(this.comment_text);e.addEventListener("kifuLoaded",function(c){c.kifu.hasComments()?(this.comments_title.innerHTML=h.t("comments"),this.element.className="wgo-commentbox",
this._update=function(d){this.setComments(d)}.bind(this),e.addEventListener("update",this._update)):(this.comments_title.innerHTML=h.t("gameinfo"),this.element.className="wgo-commentbox wgo-gameinfo",this._update&&(e.removeEventListener("update",this._update),delete this._update),this.comment_text.innerHTML=k(c.target.getGameInfo()))}.bind(this));e.notification=function(c){c?(this.notification.style.display="block",this.notification.innerHTML=c,this.is_notification=!0):(this.notification.style.display=
"none",this.is_notification=!1)}.bind(this);e.help=function(c){c?(this.help.style.display="block",this.help.innerHTML=c,this.is_help=!0):(this.help.style.display="none",this.is_help=!1)}.bind(this)});v.prototype.setComments=function(e){this.player._tmp_mark&&q.call(this.player);var c="";e.node.parent||(c=k(e.target.getGameInfo(),!0));this.comment_text.innerHTML=c+this.getCommentText(e.node.comment,this.player.config.formatNicks,this.player.config.formatMoves);this.player.config.formatMoves&&this.comment_text.childNodes&&
this.comment_text.childNodes.length&&u(this.comment_text.childNodes,this.player)};v.prototype.getCommentText=function(e,c,d){return e?(e="<p>"+h.filterHTML(e).replace(/\n/g,"</p><p>")+"</p>",c&&(e=e.replace(/(<p>)([^:]{3,}:)\s/g,'<p><span class="wgo-comments-nick">$2</span> ')),d&&(e=e.replace(/\b[a-zA-Z]1?\d\b/g,'<a href="javascript:void(0)" class="wgo-move-link">$&</a>')),e):""};h.BasicPlayer.default.formatNicks=!0;h.BasicPlayer.default.formatMoves=!0;h.BasicPlayer.attributes["data-wgo-formatnicks"]=
function(e){"false"==e.toLowerCase()&&(this.formatNicks=!1)};h.BasicPlayer.attributes["data-wgo-formatmoves"]=function(e){"false"==e.toLowerCase()&&(this.formatMoves=!1)};h.BasicPlayer.layouts.right_top.right.push("CommentBox");h.BasicPlayer.layouts.right.right.push("CommentBox");h.BasicPlayer.layouts.one_column.bottom.push("CommentBox");h.i18n.en.comments="Comments";h.i18n.en.gameinfo="Game info";h.BasicPlayer.component.CommentBox=v})(WGo);(function(h,v){var n=h.extendClass(h.BasicPlayer.component.Component,function(b){this.super(b);this.widgets=[];this.element.className="wgo-player-control";this.iconBar=document.createElement("div");this.iconBar.className="wgo-control-wrapper";this.element.appendChild(this.iconBar);var m;for(m in n.widgets){var f=new n.widgets[m].constructor(b,n.widgets[m].args);f.appendTo(this.iconBar);this.widgets.push(f)}});n.prototype.updateDimensions=function(){this.element.className=340>this.element.clientWidth?
"wgo-player-control wgo-340":440>this.element.clientWidth?"wgo-player-control wgo-440":"wgo-player-control"};var q=h.BasicPlayer.control={},u=function(b){b.node.parent||this.disabled?b.node.parent&&this.disabled&&this.enable():this.disable()},k=function(b){b.node.children.length||this.disabled?b.node.children.length&&this.disabled&&this.enable():this.disable()},e=function(b){(this._disabled=this.disabled)||this.disable()},c=function(b){this._disabled||this.enable();delete this._disabled};q.Widget=
function(b,m){this.element=this.element||document.createElement(m.type||"div");this.element.className="wgo-widget-"+m.name;this.init(b,m)};q.Widget.prototype={constructor:q.Widget,init:function(b,m){m&&(m.disabled&&this.disable(),m.init&&m.init.call(this,b))},appendTo:function(b){b.appendChild(this.element)},disable:function(){this.disabled=!0;-1==this.element.className.search("wgo-disabled")&&(this.element.className+=" wgo-disabled")},enable:function(){this.disabled=!1;this.element.className=this.element.className.replace(" wgo-disabled",
"");this.element.disabled=""}};q.Group=h.extendClass(q.Widget,function(b,m){this.element=document.createElement("div");this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+m.name;var f;for(f in m.widgets){var r=new m.widgets[f].constructor(b,m.widgets[f].args);r.appendTo(this.element)}});q.Clickable=h.extendClass(q.Widget,function(b,m){this.super(b,m)});q.Clickable.prototype.init=function(b,m){var f=this;var r=m.togglable?function(){f.disabled||(m.click.call(f,b)?f.select():f.unselect())}:function(){f.disabled||
m.click.call(f,b)};this.element.addEventListener("click",r);this.element.addEventListener("touchstart",function(w){w.preventDefault();r();m.multiple&&(f._touch_i=0,f._touch_int=window.setInterval(function(){500<f._touch_i&&r();f._touch_i+=100},100));return!1});m.multiple&&this.element.addEventListener("touchend",function(w){window.clearInterval(f._touch_int)});m.disabled&&this.disable();m.init&&m.init.call(this,b)};q.Clickable.prototype.select=function(){this.selected=!0;-1==this.element.className.search("wgo-selected")&&
(this.element.className+=" wgo-selected")};q.Clickable.prototype.unselect=function(){this.selected=!1;this.element.className=this.element.className.replace(" wgo-selected","")};q.Button=h.extendClass(q.Clickable,function(b,m){var f=this.element=document.createElement("button");f.className="wgo-button wgo-button-"+m.name;f.title=h.t(m.name);this.init(b,m)});q.Button.prototype.disable=function(){q.Button.prototype.super.prototype.disable.call(this);this.element.disabled="disabled"};q.Button.prototype.enable=
function(){q.Button.prototype.super.prototype.enable.call(this);this.element.disabled=""};q.MenuItem=h.extendClass(q.Clickable,function(b,m){var f=this.element=document.createElement("div");f.className="wgo-menu-item wgo-menu-item-"+m.name;f.title=h.t(m.name);f.innerHTML=f.title;this.init(b,m)});q.MoveNumber=h.extendClass(q.Widget,function(b){this.element=document.createElement("form");this.element.className="wgo-player-mn-wrapper";var m=this.move=document.createElement("input");m.type="text";m.value=
"0";m.maxlength=3;m.className="wgo-player-mn-value";this.element.appendChild(m);this.element.onsubmit=m.onchange=function(f){f.goTo(this.getValue());return!1}.bind(this,b);b.addEventListener("update",function(f){this.setValue(f.path.m)}.bind(this));b.addEventListener("kifuLoaded",this.enable.bind(this));b.addEventListener("frozen",this.disable.bind(this));b.addEventListener("unfrozen",this.enable.bind(this))});q.MoveNumber.prototype.disable=function(){q.MoveNumber.prototype.super.prototype.disable.call(this);
this.move.disabled="disabled"};q.MoveNumber.prototype.enable=function(){q.MoveNumber.prototype.super.prototype.enable.call(this);this.move.disabled=""};q.MoveNumber.prototype.setValue=function(b){this.move.value=b};q.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var d=function(b){if(b._menu_tmp)delete b._menu_tmp;else{if(!b.menu)for(f in b.menu=document.createElement("div"),b.menu.className="wgo-player-menu",b.menu.style.position="absolute",b.menu.style.display="none",
this.element.parentElement.appendChild(b.menu),n.menu){var m=new n.menu[f].constructor(b,n.menu[f].args,!0);m.appendTo(b.menu)}if("none"!=b.menu.style.display)return b.menu.style.display="none",document.removeEventListener("click",b._menu_ev),delete b._menu_ev,this.unselect(),!1;b.menu.style.display="block";m=this.element.offsetTop;var f=this.element.offsetLeft;this.element.parentElement.parentElement.parentElement.parentElement==b.regions.bottom.wrapper?(b.menu.style.left=f+"px",b.menu.style.top=
m-b.menu.offsetHeight+1+"px"):(b.menu.style.left=f+"px",b.menu.style.top=m+this.element.offsetHeight+"px");b._menu_ev=d.bind(this,b);b._menu_tmp=!0;document.addEventListener("click",b._menu_ev);return!0}};n.menu=[{constructor:q.MenuItem,args:{name:"switch-coo",togglable:!0,click:function(b){b.setCoordinates(!b.coordinates);return b.coordinates},init:function(b){b.coordinates&&this.select()}}}];n.widgets=[{constructor:q.Group,args:{name:"left",widgets:[{constructor:q.Button,args:{name:"menu",togglable:!0,
click:d}}]}},{constructor:q.Group,args:{name:"right",widgets:[{constructor:q.Button,args:{name:"about",click:function(b){b.showMessage(h.t("about-text"))}}}]}},{constructor:q.Group,args:{name:"control",widgets:[{constructor:q.Button,args:{name:"first",disabled:!0,init:function(b){b.addEventListener("update",u.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",c.bind(this))},click:function(b){b.first()}}},{constructor:q.Button,args:{name:"multiprev",disabled:!0,multiple:!0,
init:function(b){b.addEventListener("update",u.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",c.bind(this))},click:function(b){var m=h.clone(b.kifuReader.path);m.m-=10;b.goTo(m)}}},{constructor:q.Button,args:{name:"previous",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",u.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",c.bind(this))},click:function(b){b.previous()}}},{constructor:q.MoveNumber},{constructor:q.Button,
args:{name:"next",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",k.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",c.bind(this))},click:function(b){b.next()}}},{constructor:q.Button,args:{name:"multinext",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",k.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",c.bind(this))},click:function(b){var m=h.clone(b.kifuReader.path);m.m+=10;b.goTo(m)}}},
{constructor:q.Button,args:{name:"last",disabled:!0,init:function(b){b.addEventListener("update",k.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",c.bind(this))},click:function(b){b.last()}}}]}}];v=h.BasicPlayer.layouts;v.right_top.top.push("Control");v.right.right.push("Control");v.one_column.top.push("Control");v.no_comment.bottom.push("Control");v.minimal.bottom.push("Control");v={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",
multinext:"10 moves forward",last:"Last","switch-coo":"Display coordinates",menu:"Menu"};for(var l in v)h.i18n.en[l]=v[l];h.BasicPlayer.component.Control=n})(WGo);(function(h){var v=function(q,u){this.player.frozen||this._lastX==q&&this._lastY==u||(this._lastX=q,this._lastY=u,this._last_mark&&this.board.removeObject(this._last_mark),-1!=q&&-1!=u&&this.player.kifuReader.game.isValid(q,u)?(this._last_mark={type:"outline",x:q,y:u,c:this.player.kifuReader.game.turn},this.board.addObject(this._last_mark)):delete this._last_mark)},n=function(){this._last_mark&&(this.board.removeObject(this._last_mark),delete this._last_mark,delete this._lastX,delete this._lastY)};
h.Player.Editable={};h.Player.Editable=function(q,u){this.player=q;this.board=u;this.editMode=!1};h.Player.Editable.prototype.set=function(q){if(!this.editMode&&q)this.originalReader=this.player.kifuReader,this.player.kifuReader=new h.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath,this.originalReader.allow_illegal,this.originalReader.allow_illegal),this.player.kifuReader.goTo(this.originalReader.path),this._ev_click=this._ev_click||this.play.bind(this),this._ev_move=this._ev_move||
v.bind(this),this._ev_out=this._ev_out||n.bind(this),this.board.addEventListener("click",this._ev_click),this.board.addEventListener("mousemove",this._ev_move),this.board.addEventListener("mouseout",this._ev_out),this.editMode=!0;else if(this.editMode&&!q){this.originalReader.goTo(this.player.kifuReader.path);q=this.originalReader;for(var u=this.player.kifuReader.getPosition(),k=this.originalReader.getPosition(),e=u.size,c=[],d=[],l=0;l<e*e;l++)u.schema[l]&&!k.schema[l]?d.push({x:Math.floor(l/e),
y:l%e}):u.schema[l]!=k.schema[l]&&c.push({x:Math.floor(l/e),y:l%e,c:k.schema[l]});q.change={add:c,remove:d};this.player.kifuReader=this.originalReader;this.player.update(!0);this.board.removeEventListener("click",this._ev_click);this.board.removeEventListener("mousemove",this._ev_move);this.board.removeEventListener("mouseout",this._ev_out);this.editMode=!1}};h.Player.Editable.prototype.play=function(q,u){!this.player.frozen&&this.player.kifuReader.game.isValid(q,u)&&(this.player.kifuReader.node.appendChild(new h.KNode({move:{x:q,
y:u,c:this.player.kifuReader.game.turn},_edited:!0})),this.player.next(this.player.kifuReader.node.children.length-1))};h.BasicPlayer&&h.BasicPlayer.component.Control&&h.BasicPlayer.component.Control.menu.push({constructor:h.BasicPlayer.control.MenuItem,args:{name:"editmode",togglable:!0,click:function(q){this._editable=this._editable||new h.Player.Editable(q,q.board);this._editable.set(!this._editable.editMode);return this._editable.editMode},init:function(q){var u=this;q.addEventListener("frozen",
function(k){(u._disabled=u.disabled)||u.disable()});q.addEventListener("unfrozen",function(k){u._disabled||u.enable();delete u._disabled})}}});h.i18n.en.editmode="Edit mode"})(WGo);(function(h){var v=function(k,e,c,d){this.originalPosition=k;this.position=k.clone();this.board=e;this.komi=c;this.output=d},n=v.state={UNKNOWN:0,BLACK_STONE:1,WHITE_STONE:-1,BLACK_CANDIDATE:2,WHITE_CANDIDATE:-2,BLACK_NEUTRAL:3,WHITE_NEUTRAL:-3,NEUTRAL:4},q=function(k,e,c,d,l){var b=k.get(e,c);void 0!==b&&b!=d&&b!=l&&(k.set(e,c,d),q(k,e-1,c,d,l),q(k,e,c-1,d,l),q(k,e+1,c,d,l),q(k,e,c+1,d,l))},u=function(k,e,c,d,l){var b=e.get(c,d);k.get(c,d)!=b&&(k.set(c,d,b),u(k,e,c-1,d,l),u(k,e,c,d-1,l),u(k,e,c+
1,d,l),u(k,e,c,d+1,l))};v.prototype.start=function(){this.calculate();this.saved_state=this.board.getState();this.displayScore();this._click=function(k,e){var c=this.originalPosition.get(k,e);c==h.W?this.position.get(k,e)==n.WHITE_STONE?q(this.position,k,e,n.BLACK_CANDIDATE,n.BLACK_STONE):(u(this.position,this.originalPosition,k,e,n.BLACK_STONE),this.calculate()):c==h.B?this.position.get(k,e)==n.BLACK_STONE?q(this.position,k,e,n.WHITE_CANDIDATE,n.WHITE_STONE):(u(this.position,this.originalPosition,
k,e,n.WHITE_STONE),this.calculate()):(c=this.position.get(k,e),c==n.BLACK_CANDIDATE?this.position.set(k,e,n.BLACK_NEUTRAL):c==n.WHITE_CANDIDATE?this.position.set(k,e,n.WHITE_NEUTRAL):c==n.BLACK_NEUTRAL?this.position.set(k,e,n.BLACK_CANDIDATE):c==n.WHITE_NEUTRAL&&this.position.set(k,e,n.WHITE_CANDIDATE));this.board.restoreState({objects:h.clone(this.saved_state.objects)});this.displayScore()}.bind(this);this.board.addEventListener("click",this._click)};v.prototype.end=function(){this.board.restoreState({objects:h.clone(this.saved_state.objects)});
this.board.removeEventListener("click",this._click)};v.prototype.displayScore=function(){for(var k=[],e=[],c=[],d=[],l=[],b=0;b<this.position.size;b++)for(var m=0;m<this.position.size;m++)s=this.position.get(b,m),t=this.originalPosition.get(b,m),s==n.BLACK_CANDIDATE?k.push({x:b,y:m,type:"mini",c:h.B}):s==n.WHITE_CANDIDATE?e.push({x:b,y:m,type:"mini",c:h.W}):s==n.NEUTRAL&&c.push({x:b,y:m}),t==h.W&&s!=n.WHITE_STONE?l.push({x:b,y:m,type:"outline",c:h.W}):t==h.B&&s!=n.BLACK_STONE&&d.push({x:b,y:m,type:"outline",
c:h.B});for(b=0;b<d.length;b++)this.board.removeObjectsAt(d[b].x,d[b].y);for(b=0;b<l.length;b++)this.board.removeObjectsAt(l[b].x,l[b].y);this.board.addObject(l);this.board.addObject(d);this.board.addObject(k);this.board.addObject(e);c="<p style='font-weight: bold;'>"+h.t("RE")+"</p>";b=k.length+l.length+this.originalPosition.capCount.black;m=e.length+d.length+this.originalPosition.capCount.white+parseFloat(this.komi);c+="<p>"+h.t("black")+": "+k.length+" + "+(l.length+this.originalPosition.capCount.black)+
" = "+b+"</br>";c+=h.t("white")+": "+e.length+" + "+(d.length+this.originalPosition.capCount.white)+" + "+this.komi+" = "+m+"</p>";c=b>m?c+("<p style='font-weight: bold;'>"+h.t("bwin",b-m)+"</p>"):c+("<p style='font-weight: bold;'>"+h.t("wwin",m-b)+"</p>");this.output(c)};v.prototype.calculate=function(){var k,e;var c=this.position;for(e=!0;e;){e=!1;for(var d=0;d<c.size;d++)for(var l=0;l<c.size;l++){var b=c.get(l,d);if(b==n.UNKNOWN||b==n.BLACK_CANDIDATE||b==n.WHITE_CANDIDATE){var m=[c.get(l-1,d),
c.get(l,d-1),c.get(l+1,d),c.get(l,d+1)];var f=k=!1;for(var r=0;4>r;r++)m[r]==n.BLACK_STONE||m[r]==n.BLACK_CANDIDATE?k=!0:m[r]==n.WHITE_STONE||m[r]==n.WHITE_CANDIDATE?f=!0:m[r]==n.NEUTRAL&&(f=k=!0);m=!1;k&&f?m=n.NEUTRAL:k?m=n.BLACK_CANDIDATE:f&&(m=n.WHITE_CANDIDATE);m&&b!=m&&(e=!0,c.set(l,d,m))}}}};h.ScoreMode=v;h.BasicPlayer&&h.BasicPlayer.component.Control&&h.BasicPlayer.component.Control.menu.push({constructor:h.BasicPlayer.control.MenuItem,args:{name:"scoremode",togglable:!0,click:function(k){if(this.selected)return k.setFrozen(!1),
this._score_mode.end(),delete this._score_mode,k.notification(),k.help(),!1;k.setFrozen(!0);k.help("<p>"+h.t("help_score")+"</p>");this._score_mode=new h.ScoreMode(k.kifuReader.game.position,k.board,k.kifu.info.KM||.5,k.notification);this._score_mode.start();return!0}}});h.i18n.en.scoremode="Count score";h.i18n.en.score="Score";h.i18n.en.bwin="Black wins by $ points.";h.i18n.en.wwin="White wins by $ points.";h.i18n.en.help_score="Click on stones to mark them dead or alive. You can also set and unset territory points by clicking on them. Territories must be completely bordered."})(WGo);(function(h,v){var n={active:!0,query:{}},q=function(k){try{n.query=JSON.parse('{"'+window.location.hash.substr(1).replace("=",'":')+"}")}catch(e){n.query={}}};window.addEventListener("hashchange",function(){if(""!=window.location.hash&&n.active){q();for(var k in n.query){var e=document.getElementById(k);e&&e._wgo_player&&e._wgo_player.goTo(u)}}});window.addEventListener("DOMContentLoaded",function(){""!=window.location.hash&&n.active&&q()});window.addEventListener("load",function(){if(""!=window.location.hash&&
n.active)for(var k in n.query){var e=document.getElementById(k);if(e&&e._wgo_player){e.scrollIntoView();break}}});var u=function(){if(n.query[this.element.id])return n.query[this.element.id].goto};h.Player.default.move=u;h.BasicPlayer&&h.BasicPlayer.component.Control&&h.BasicPlayer.component.Control.menu.push({constructor:h.BasicPlayer.control.MenuItem,args:{name:"permalink",click:function(k){var e=location.href.split("#")[0]+"#"+k.element.id+'={"goto":'+JSON.stringify(k.kifuReader.path)+"}";k.showMessage("<h1>"+
h.t("permalink")+'</h1><p><input class="wgo-permalink" type="text" value=\''+e+'\' onclick="this.select(); event.stopPropagation()"/></p>')}}});h.Player.permalink=n;h.i18n.en.permalink="Permanent link"})(WGo);
